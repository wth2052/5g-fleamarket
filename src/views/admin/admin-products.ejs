<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>ìƒí’ˆ</title>

  <!--    BootStrap Library-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link
      href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&family=Jua&family=Noto+Serif+KR:wght@200&display=Gowun+Dodum&display=swap"
      rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
          <script src="https://code.jquery.com/jquery-3.5.1.js"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  

</head>
<style>

  #image-container{
     padding: 0;
     height: 166px;  
  }

  #image{
    width: 100%; height: 100%; 
    margin: 0;  
 
    border: 3px dotted #5cd7f2; border-radius: 3px;
  }

  #product-btn{
    background-color: #05AFF2;
  }

.col-md-8 > h3 {
  border: 1px solid #05AFF2; 
  margin-top: 10px;
  width: 300px;
  border-radius: 4px;
}

#products-column {
  height: 166px;
  width: 50%;
 
  border: 3px dotted #5cd7f2; border-radius: 3px;
}


</style>
<script>

</script>
<body>

  <%- include('admin-header.ejs')%>

<div class="container-fluid" style="background:#eee; margin-top: 40px; margin-bottom: 40px;">
  <div class="container" style="background: #fff; margin-top: 20px;padding: 0;" id="bb">
    
    <% if (typeof errorMessage !== 'undefined') { %>
            <%= errorMessage %>
          <% } else if (products) { %>


            <% for (var i = 0; i < products.length; i++) { %>
              <div class="container-fluid" style=" margin-top: 20px;" onclick="getProduct('<%= products[i].id %>')">
                <div class="row" style="cursor: pointer; "  >
                  <div class="col-md-3" style="margin-left: 13%;" id="image-container">
                    <img src="https://news.koreadaily.com/data/photo/2023/03/10/202303040941779270_6404a4b927e18.jpg" alt="spcFuck" id="image"/>
                  </div>
                  <div class="col-md-8" id="products-column" >
                      <h3 > <%= products[i].title %></h3>
                      <h3><%= products[i].price %> ì›</h3>
                      <br>
                      <span style="float: right;">â¤ <%= products[i].likes %></span>
                      <span style="float: right;">ğŸ¯<%= products[i].dealCount %>  &nbsp </span>
                      <span style="float: right;">ğŸ‘€:<%= products[i].viewCount %>íšŒ &nbsp</span>
                      
                    </div>
                </div>
              </div>
            <% } %>
            <div id="ss"></div>

            
            <% if (products.length < totalProducts) { %>
              <div class="text-center mt-3">
                <button onclick="pageProduct(<%= products.length %>, <%= totalProducts%> )" id="load-more-btn" class="btn btn-primary load-more" data-limit="<%= products.length %>" data-offset="<%= products.length %>">ë” ë³´ê¸°</button>
              </div>
            <% } %>
            
          <% } %>
  </div>



</div>

<!--í•˜ë‹¨ ë©”ë‰´ë°”-->

<%- include('admin-footer.ejs')%>

</body>
<script><%- include('js/admin-layout.js') %></script>
<script>

  
function pageProduct(productsLength, totalProducts){
console.log(productsLength)
console.log(totalProducts)

  const loadMoreBtn = document.getElementById('load-more-btn');
    const limit = Number(loadMoreBtn.getAttribute('data-limit')) 
    const offset = Number(loadMoreBtn.getAttribute('data-offset'));
  
    axios.get('/api/products?limit=' + limit + '&offset=' + offset )
          .then(function(res) {
            
            loadMoreBtn.remove()
            const products = res.data.products
            console.log(products)
            let temp = '';
            for (let i = 0; i < products.length; i++) {
            
              temp += `
              <div class="container-fluid" style=" margin-top: 20px;" onclick="getProduct(${products[i].id})">
                <div class="row" style="cursor: pointer; "  >
                  <div class="col-md-3" style="margin-left: 13%;" id="image-container">
                    <img src="https://news.koreadaily.com/data/photo/2023/03/10/202303040941779270_6404a4b927e18.jpg" alt="spcFuck" id="image"/>
                  </div>
                  <div class="col-md-8" id="products-column" >
                      <h3 >${products[i].title} </h3>
                      <h3> ${products[i].price}ì›</h3>
                      <br>
                      <span style="float: right;">â¤ ${products[i].likes}</span>
                      <span style="float: right;">ğŸ¯ ${products[i].dealCount} &nbsp </span>
                      <span style="float: right;">ğŸ‘€:${products[i].viewCount}íšŒ &nbsp</span>
                      
                    </div>
                </div>
              </div>
              `
            }
            $('#ss').append(temp)
            

             if (products.length < res.data.totalProducts) {
              const newLength = products.length + productsLength
              const TotalProducts = res.data.totalProducts
              const loadMoreBtn = `
                <div class="text-center mt-3">
                  <button onclick="pageProduct(${newLength}, ${TotalProducts})" id="load-more-btn" class="btn btn-primary load-more" data-limit="${newLength}" data-offset="${newLength}"> ë” ë³´ê¸° </button>
                </div>
              `
              $('#ss').append(loadMoreBtn)
             }
          })
          .catch(function(error) {
            if (productsLength === totalProducts){
              alert('ë') 
             }
             else{
               alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
             }
          });
        }

  
</script>

</html>